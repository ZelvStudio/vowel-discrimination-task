{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/vowel-radio.css')}}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/vowel-buttons.css')}}">
{% endblock %}

{% block body %}
<div class="w3-container w3-content w3-margin-top">
    <div class="w3-container w3-card-3 w3-white w3-margin-top">
        <header class="w3-center w3-teal w3-margin-top">
            <div class="row">
                <div class="header-column w3-center">
                    <h2>
                        <b>Références</b>
                    </h2>
                </div>
                <div class="header-column"></div>
            </div>
        </header>
        <p>
        Ecoutez chaque voyelle ci dessous en cliquant dessus. Ces voyelles seront appelées par la suite "références".
        </p>

        <br>

        <p>

        <form action="/conditioning" method="POST" accept-charset="utf-8">

            <input id="listens" type="hidden" name="listens" value="">

            <div class="column">
                <div class="vowel-buttons">
                    {% for vowel, vowel_sound in vowels %}
                    <div>
                        <button type="button" class="vowel-button" onclick="play('{{vowel}}_sound')">
                            {{vowel}}
                        </button>
                        <audio id="{{vowel}}_sound" src="{{vowel_sound}}">
                    </div>
                    {% endfor %}
                </div>
                <br>
            </div>

            </p>

            <p>
            <!-- Prevent implicit submission of the form -->
            <button type="submit" disabled style="display: none" aria-hidden="true"></button>
            <!-- ... -->
            <div class="w3-center" style="display: none" id="continue_button">
                <input class="w3-button w3-center w3-section w3-teal w3-ripple" type="submit" value="Valider et continuer"/>
            </div>
            </p>

        </form>
    </div>
    <br>
</div>

<script>
    let listensTracker = document.getElementById('listens');
    let listens = listensTracker.value;

    function add_listen(text) {
        if (listens != '') {
            listens += ' '
        }
        listens += text;
        listensTracker.value = listens;
    }

    function vowels_were_all_listened_to() {
        {% for vowel, _ in vowels %}
        if (!listens.includes('{{vowel}}')) {
            return false
        }
        {% endfor %}

        return true
    }

    function show_continue_button() {
        var x = document.getElementById("continue_button");
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }

    function play(vowel_id) {
        var audio = document.getElementById(vowel_id);
        audio.play();
        let vowel = vowel_id.replace('_sound', '');
        add_listen(vowel);
        if (vowels_were_all_listened_to()) {
            show_continue_button();
        }
    }
</script>

{% endblock %}
